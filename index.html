<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jump Sort Simulation</title>
  <style>
    :root {
      --bg-body: #0f172a;
      --bg-card: #1e293b;
      --bg-panel: #334155;
      --primary: #6366f1;
      --primary-hover: #4f46e5;
      --accent-pos: #10b981; /* Green for positives */
      --accent-neg: #f43f5e; /* Red for negatives */
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --border: #475569;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-body);
      color: var(--text-main);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Layout & Containers */
    .container {
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #818cf8, #c084fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 1.1rem;
    }

    /* Controls Section */
    .controls-area {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .metadata-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
      text-align: center;
    }

    .meta-item {
      background: var(--bg-panel);
      padding: 10px;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
    }

    .meta-label {
      display: block;
      font-size: 0.85rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .meta-value {
      font-weight: bold;
      font-size: 1.1rem;
      color: var(--text-main);
    }

    .buttons-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 15px;
      padding-top: 10px;
      border-top: 1px solid var(--border);
    }

    button {
      background-color: var(--primary);
      color: white;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      padding: 10px 24px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover:not(:disabled) {
      background-color: var(--primary-hover);
      transform: translateY(-1px);
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      filter: grayscale(1);
    }

    button.secondary {
      background-color: var(--bg-panel);
      border: 1px solid var(--border);
    }
    
    button.secondary:hover:not(:disabled) {
      background-color: var(--border);
    }

    .speed-control {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    input[type="range"] {
      cursor: pointer;
    }

    /* Visualizer Stage */
    .stage-container {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      min-height: 400px;
      display: flex;
      flex-direction: column;
    }

    .step-info {
      text-align: center;
      margin-bottom: 20px;
      height: 24px; /* Prevent jump */
    }

    .current-status {
      font-weight: 600;
      color: var(--primary);
      font-size: 1.1rem;
    }

    .visualizer {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      height: 300px;
      gap: 4px;
      position: relative;
      padding: 0 20px;
      overflow-x: auto; /* Handle overflow if array is huge */
    }

    .bar-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 30px;
      position: relative;
      transition: all 0.3s ease;
    }

    .bar {
      width: 100%;
      border-radius: 4px 4px 0 0;
      transition: height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 0.3s;
      position: relative;
      min-height: 4px; /* Ensure visibility even if 0 */
    }

    /* Value Label */
    .bar-val {
      margin-top: 5px;
      font-size: 12px;
      color: var(--text-main);
      font-weight: bold;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s, transform 0.3s;
    }

    /* Show value if bar is hovered or active */
    .bar-wrapper:hover .bar-val,
    .bar-wrapper.active .bar-val {
      opacity: 1;
      transform: translateY(0);
    }

    /* Bar Types */
    .bar.pos { background-color: var(--accent-pos); box-shadow: 0 0 10px rgba(16, 185, 129, 0.3); }
    .bar.neg { background-color: var(--accent-neg); box-shadow: 0 0 10px rgba(244, 63, 94, 0.3); }
    .bar.empty { 
      background-color: rgba(255, 255, 255, 0.05); 
      border: 1px dashed rgba(255, 255, 255, 0.1);
      height: 20px !important; /* Fixed height for placeholders */
    }

    /* Index Label for buckets */
    .bucket-idx {
      position: absolute;
      bottom: -20px;
      font-size: 10px;
      color: var(--text-muted);
      width: 100%;
      text-align: center;
    }

    /* Code Implementation Section */
    .implementation-section {
      background: var(--bg-card);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .tabs-header {
      display: flex;
      background: var(--bg-panel);
      border-bottom: 1px solid var(--border);
    }

    .tab {
      padding: 15px 25px;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.2s;
      font-weight: 500;
      border-bottom: 3px solid transparent;
    }

    .tab:hover {
      color: var(--text-main);
      background: rgba(255,255,255,0.05);
    }

    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      background: var(--bg-card);
    }

    .code-content {
      padding: 20px;
      overflow-x: auto;
      background: #0d1117;
      color: #c9d1d9;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .code-block {
      display: none;
    }
    .code-block.active {
      display: block;
    }

    /* Footer */
    footer {
      margin-top: 50px;
      text-align: center;
      color: var(--text-muted);
      padding: 20px;
      border-top: 1px solid var(--border);
      font-size: 0.9rem;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
      transition: color 0.2s;
    }

    footer a:hover {
      color: #818cf8;
      text-decoration: underline;
    }

    .footer-github {
      display: inline-block;
      margin-top: 15px;
      background: #24292e;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      text-decoration: none !important;
      font-weight: bold;
      transition: background 0.2s;
    }
    .footer-github:hover {
      background: #3c444d;
    }

    /* Utility */
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Jump Sort Visualization</h1>
    <p class="subtitle">Visualizing an O(n + k) distribution sort algorithm</p>
  </header>

  <main>
    <!-- Controls & Metadata -->
    <section class="controls-area">
      <div class="metadata-grid">
        <div class="meta-item">
          <span class="meta-label">Time Complexity</span>
          <span class="meta-value">O(n + k)</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Space Complexity</span>
          <span class="meta-value">O(n + k)</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Method</span>
          <span class="meta-value">Direct Indexing</span>
        </div>
      </div>

      <div class="buttons-row">
        <button id="btnGenerate" class="secondary" onclick="initArray()">üé≤ Randomize Data</button>
        
        <div class="speed-control">
          <span>Speed:</span>
          <input type="range" id="speedRange" min="10" max="1000" value="500" step="10">
        </div>

        <button id="btnStart" onclick="startSimulation()">‚ñ∂Ô∏è Start Simulation</button>
        <button id="btnPause" class="hidden" onclick="pauseSimulation()">‚è∏Ô∏è Pause</button>
        <button id="btnStep" class="secondary" onclick="stepSimulation()">‚èØÔ∏è Step</button>
        <button id="btnReset" class="secondary" onclick="resetSimulation()" disabled>‚èπÔ∏è Reset</button>
      </div>
    </section>

    <!-- Visualizer Stage -->
    <section class="stage-container">
      <div class="step-info">
        <span id="statusText" class="current-status">Ready to sort...</span>
      </div>
      
      <!-- The Visualization Area -->
      <div class="visualizer" id="visualizer">
        <!-- Bars injected here via JS -->
      </div>
    </section>

    <!-- Implementations -->
    <section class="implementation-section">
      <div class="tabs-header">
        <div class="tab active" onclick="switchTab('java')">Java</div>
        <div class="tab" onclick="switchTab('python')">Python</div>
      </div>
      <div class="code-content">
        <div id="java" class="code-block active">
<pre>
<span style="color:#ff7b72">public class</span> <span style="color:#d2a8ff">JumpSort</span> {
    <span style="color:#ff7b72">public int[]</span> <span style="color:#d2a8ff">sortArray</span>(<span style="color:#ff7b72">int[]</span> nums) {
        <span style="color:#8b949e">// Separate negatives and non-negatives</span>
        <span style="color:#ff7b72">int</span>[] negatives = <span style="color:#ff7b72">new int</span>[nums.length];
        <span style="color:#ff7b72">int</span>[] nonNegatives = <span style="color:#ff7b72">new int</span>[nums.length];
        <span style="color:#ff7b72">int</span> negCount = <span style="color:#79c0ff">0</span>, posCount = <span style="color:#79c0ff">0</span>;

        <span style="color:#ff7b72">for</span> (<span style="color:#ff7b72">int</span> num : nums) {
            <span style="color:#ff7b72">if</span> (num < <span style="color:#79c0ff">0</span>) negatives[negCount++] = num;
            <span style="color:#ff7b72">else</span> nonNegatives[posCount++] = num;
        }

        <span style="color:#8b949e">// Handle negatives (bucketed using abs)</span>
        <span style="color:#ff7b72">int</span> maxAbsNeg = <span style="color:#79c0ff">0</span>;
        <span style="color:#ff7b72">for</span> (<span style="color:#ff7b72">int</span> i = <span style="color:#79c0ff">0</span>; i < negCount; i++) {
            maxAbsNeg = Math.<span style="color:#d2a8ff">max</span>(maxAbsNeg, Math.<span style="color:#d2a8ff">abs</span>(negatives[i]));
        }
        <span style="color:#8b949e">// ... (Bucket creation logic) ...</span>
        
        <span style="color:#8b949e">// Flatten and combine results</span>
        <span style="color:#ff7b72">int</span>[] result = <span style="color:#ff7b72">new int</span>[nums.length];
        <span style="color:#8b949e">// ... (Merge logic) ...</span>
        <span style="color:#ff7b72">return</span> result;
    }
}
</pre>
        </div>
        <div id="python" class="code-block">
<pre>
<span style="color:#ff7b72">class</span> <span style="color:#d2a8ff">JumpSort</span>:
    <span style="color:#ff7b72">def</span> <span style="color:#d2a8ff">sortArray</span>(self, nums):
        <span style="color:#8b949e"># Separate negatives and non-negatives</span>
        negatives = [x <span style="color:#ff7b72">for</span> x <span style="color:#ff7b72">in</span> nums <span style="color:#ff7b72">if</span> x < <span style="color:#79c0ff">0</span>]
        non_negatives = [x <span style="color:#ff7b72">for</span> x <span style="color:#ff7b72">in</span> nums <span style="color:#ff7b72">if</span> x >= <span style="color:#79c0ff">0</span>]

        <span style="color:#8b949e"># Prepare negative side using counts (Pigeonhole sort variation)</span>
        <span style="color:#ff7b72">if</span> negatives:
            max_neg = <span style="color:#d2a8ff">abs</span>(<span style="color:#d2a8ff">min</span>(negatives))
            neg_counts = [<span style="color:#79c0ff">0</span>] * max_neg
            <span style="color:#ff7b72">for</span> num <span style="color:#ff7b72">in</span> negatives:
                index = <span style="color:#d2a8ff">abs</span>(num) - <span style="color:#79c0ff">1</span>
                neg_counts[index] += <span style="color:#79c0ff">1</span>
            <span style="color:#8b949e"># Reconstruct negative list (sorted)</span>
            neg_list = []
            <span style="color:#ff7b72">for</span> i <span style="color:#ff7b72">in</span> <span style="color:#d2a8ff">reversed</span>(<span style="color:#d2a8ff">range</span>(max_neg)):
                neg_list.extend([-i - <span style="color:#79c0ff">1</span>] * neg_counts[i])
        <span style="color:#ff7b72">else</span>:
            neg_list = []

        <span style="color:#8b949e"># Prepare non-negative side using counts</span>
        <span style="color:#ff7b72">if</span> non_negatives:
            max_nonneg = <span style="color:#d2a8ff">max</span>(non_negatives)
            pos_counts = [<span style="color:#79c0ff">0</span>] * (max_nonneg + <span style="color:#79c0ff">1</span>)
            <span style="color:#ff7b72">for</span> num <span style="color:#ff7b72">in</span> non_negatives:
                pos_counts[num] += <span style="color:#79c0ff">1</span>
            <span style="color:#8b949e"># Reconstruct positive list</span>
            pos_list = []
            <span style="color:#ff7b72">for</span> i <span style="color:#ff7b72">in</span> <span style="color:#d2a8ff">range</span>(max_nonneg + <span style="color:#79c0ff">1</span>):
                pos_list.extend([i] * pos_counts[i])
        <span style="color:#ff7b72">else</span>:
            pos_list = []

        <span style="color:#ff7b72">return</span> neg_list + pos_list
</pre>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>üöÄ Made with care by Jaspreet Jawanda</p>
    <p style="margin-top: 5px;">
      üåê <a href="https://www.jjawanda.me" target="_blank">My Website</a> | 
      üíº <a href="https://www.linkedin.com/in/jaspreet-jawanda/" target="_blank">LinkedIn</a>
    </p>
    <br>
    <a href="https://github.com/sayanwala117/JumpSort" target="_blank" class="footer-github">
      ‚≠ê View this project on GitHub
    </a>
  </footer>
</div>

<script>
  // --- State Management ---
  const state = {
    array: [],
    steps: [], // Stores the snapshots of the algorithm
    currentStepIndex: 0,
    isPlaying: false,
    speed: 500,
    controller: null // To abort async animation
  };

  // --- DOM Elements ---
  const visualizer = document.getElementById('visualizer');
  const statusText = document.getElementById('statusText');
  const btnStart = document.getElementById('btnStart');
  const btnPause = document.getElementById('btnPause');
  const btnStep = document.getElementById('btnStep');
  const btnReset = document.getElementById('btnReset');
  const btnGenerate = document.getElementById('btnGenerate');
  const speedRange = document.getElementById('speedRange');

  // --- Initialization ---
  function initArray() {
    // Generate random array: mix of small negatives and positives
    // We keep range small (-20 to 20) so the "Jump" visualization fits on screen
    const size = 15;
    const arr = [];
    for (let i = 0; i < size; i++) {
      // Generate between -20 and 20
      const val = Math.floor(Math.random() * 41) - 20; 
      arr.push(val);
    }
    state.array = arr;
    
    // Pre-calculate steps immediately for instant feedback
    state.steps = calculateJumpSortSteps(arr);
    state.currentStepIndex = 0;
    
    resetUIState();
    renderStep(0);
    updateStatus("Ready. Click Start to begin sorting.");
  }

  function resetUIState() {
    pauseSimulation();
    state.currentStepIndex = 0;
    state.isPlaying = false;
    btnStart.classList.remove('hidden');
    btnPause.classList.add('hidden');
    btnReset.disabled = true;
    btnGenerate.disabled = false;
    btnStep.disabled = false;
  }

  function resetSimulation() {
    state.currentStepIndex = 0;
    resetUIState();
    renderStep(0);
    updateStatus("Simulation reset.");
  }

  // --- Logic: Step Generation ---
  // This function runs the logic virtually to create "snapshots" for the visualizer
  function calculateJumpSortSteps(input) {
    const steps = [];

    // Step 0: Initial State
    steps.push({
      title: "Initial Unsorted Array",
      bars: input.map(v => ({ val: v, type: v < 0 ? 'neg' : 'pos' })),
      showIndices: false
    });

    // Step 1: Separation
    const negatives = input.filter(n => n < 0);
    const nonNegatives = input.filter(n => n >= 0);
    
    steps.push({
      title: "Step 1: Split into Negatives (Red) and Non-Negatives (Green)",
      bars: [
        ...negatives.map(v => ({ val: v, type: 'neg' })),
        ...nonNegatives.map(v => ({ val: v, type: 'pos' }))
      ],
      showIndices: false
    });

    // Step 2: The "Jump" (Buckets)
    // Determine range for buckets
    const maxAbsNeg = Math.max(...negatives.map(n => Math.abs(n)), 0);
    const maxPos = Math.max(...nonNegatives, 0);

    // Create negative buckets (reversed absolute mapping)
    // In a visual list: index 0 corresponds to -maxAbsNeg, index max-1 corresponds to -1
    // To match the user's provided logic code "maxAbsNeg - abs(neg)":
    // If maxAbsNeg is 5.
    // Val -5 -> index 0. Val -1 -> index 4.
    const negListSize = maxAbsNeg; 
    const negBuckets = Array(negListSize).fill(null);
    negatives.forEach(n => {
      const index = maxAbsNeg - Math.abs(n); 
      negBuckets[index] = n;
    });

    // Create positive buckets (direct mapping)
    // Val 0 -> index 0. Val 5 -> index 5.
    const posBuckets = Array(maxPos + 1).fill(null);
    nonNegatives.forEach(n => {
      posBuckets[n] = n;
    });

    // Visual representation of buckets
    const negBarObjs = negBuckets.map(v => v === null ? null : { val: v, type: 'neg' });
    const posBarObjs = posBuckets.map(v => v === null ? null : { val: v, type: 'pos' });

    steps.push({
      title: "Step 2: 'Jump' to Indexed Buckets (Gray slots are empty space)",
      bars: [...negBarObjs, ...posBarObjs],
      showIndices: true, // Important to show the "Jump" target indices
      rangeStart: -maxAbsNeg // To label indices correctly if we wanted (simplified here)
    });

    // Step 3: Flattening (The Result)
    const result = [
      ...negBuckets.filter(n => n !== null),
      ...posBuckets.filter(n => n !== null)
    ];

    steps.push({
      title: "Step 3: Final Sorted Output",
      bars: result.map(v => ({ val: v, type: v < 0 ? 'neg' : 'pos' })),
      showIndices: false
    });

    return steps;
  }

  // --- Rendering ---
  function renderStep(index) {
    if (index < 0 || index >= state.steps.length) return;

    const stepData = state.steps[index];
    visualizer.innerHTML = '';
    updateStatus(stepData.title);

    stepData.bars.forEach((item, i) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'bar-wrapper';

      if (item === null) {
        // Render Empty Slot
        const bar = document.createElement('div');
        bar.className = 'bar empty';
        wrapper.appendChild(bar);
        
        if (stepData.showIndices) {
           // In the negative section, index logic is tricky visually.
           // Let's just show a simple index counter for the whole view
           const idxLabel = document.createElement('span');
           idxLabel.className = 'bucket-idx';
           // This is a simplification for visualization
           idxLabel.innerText = i; 
           wrapper.appendChild(idxLabel);
        }

      } else {
        // Render Value
        const bar = document.createElement('div');
        bar.className = `bar ${item.type}`;
        // Scale height: 10px base + 5px per unit value
        const height = Math.abs(item.val) * 8 + 10;
        bar.style.height = `${height}px`;
        
        wrapper.appendChild(bar);

        const valLabel = document.createElement('span');
        valLabel.className = 'bar-val';
        valLabel.innerText = item.val;
        wrapper.appendChild(valLabel);
      }

      visualizer.appendChild(wrapper);
    });

    // Highlight active bars if needed (e.g., just show all)
    const wrappers = document.querySelectorAll('.bar-wrapper');
    wrappers.forEach(w => w.classList.add('active'));
  }

  function updateStatus(text) {
    statusText.innerText = text;
  }

  // --- Animation Control ---

  const sleep = (ms) => new Promise(r => setTimeout(r, ms));

  async function startSimulation() {
    if (state.currentStepIndex >= state.steps.length - 1) {
      resetSimulation();
    }

    state.isPlaying = true;
    btnStart.classList.add('hidden');
    btnPause.classList.remove('hidden');
    btnReset.disabled = true;
    btnGenerate.disabled = true;
    btnStep.disabled = true;

    while (state.isPlaying && state.currentStepIndex < state.steps.length - 1) {
      state.currentStepIndex++;
      renderStep(state.currentStepIndex);
      
      // Calculate delay based on slider (inverted logic: higher value = faster speed)
      // Slider value 10 (slow) -> 1000ms
      // Slider value 1000 (fast) -> 10ms
      const delay = 1010 - state.speed;
      await sleep(delay);
    }

    if (state.currentStepIndex >= state.steps.length - 1) {
      finishSimulation();
    }
  }

  function pauseSimulation() {
    state.isPlaying = false;
    btnStart.classList.remove('hidden');
    btnPause.classList.add('hidden');
    btnReset.disabled = false;
    btnGenerate.disabled = false;
    btnStep.disabled = false;
    btnStart.innerText = "‚ñ∂Ô∏è Resume";
  }

  function finishSimulation() {
    state.isPlaying = false;
    btnStart.classList.remove('hidden');
    btnPause.classList.add('hidden');
    btnReset.disabled = false;
    btnGenerate.disabled = false;
    btnStep.disabled = false;
    btnStart.innerText = "‚Üª Restart";
    updateStatus("Sorting Complete!");
  }

  function stepSimulation() {
    if (state.currentStepIndex < state.steps.length - 1) {
      state.currentStepIndex++;
      renderStep(state.currentStepIndex);
      if (state.currentStepIndex >= state.steps.length - 1) {
        finishSimulation();
      }
    }
  }

  // --- Event Listeners ---
  speedRange.addEventListener('input', (e) => {
    state.speed = parseInt(e.target.value);
  });

  function switchTab(lang) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.code-block').forEach(b => b.classList.remove('active'));
    
    // Find the clicked tab
    const clickedTab = Array.from(document.querySelectorAll('.tab')).find(t => t.innerText.toLowerCase() === lang);
    if(clickedTab) clickedTab.classList.add('active');
    
    document.getElementById(lang).classList.add('active');
  }

  // Start
  initArray();

</script>
</body>
</html>
